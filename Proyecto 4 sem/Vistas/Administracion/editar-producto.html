<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Editar Producto</title>
		<link rel="stylesheet" href="../../css/EstilosAdmin.css">
</head>
<body class="admin-panel">
	<aside class="sidebar">
		<h2>Administrador</h2>
		<ul>
			<li><a href="dashboard.html">Dashboard</a></li>
			<li><a href="usuario.html">Usuarios</a></li>
			<li><a href="adm-prodcutos.html">Productos</a></li>
			<li><a href="ordenes.html">Órdenes</a></li>
			<li><a href="mensaje.html">Mensajes</a></li>
			<li><a href="configuracion.html">Configuración</a></li>
		</ul>
		<ul>
			<li><a href="../home.html" class="inicio-sesion">Cerrar Sesión</a></li>
		</ul>
	</aside>
	<div class="admin-wrapper">
		<main class="admin-main">
			<h1 class="admin-main-title">Editar Producto</h1>
			<div class="editar-buscador">
				<input type="text" id="buscador-producto" placeholder="Buscar por nombre o código..." autocomplete="off" class="editar-buscador-input">
				<ul id="sugerencias-producto" class="editar-buscador-sugerencias"></ul>
			</div>
			<form id="form-editar-producto" enctype="multipart/form-data" autocomplete="off" class="editar-form">
				<div>
					<label for="codigo">Código producto *</label>
					<input type="text" id="codigo" name="codigo" required minlength="3" readonly>
				</div>
				<div>
					<label for="nombre">Nombre *</label>
					<input type="text" id="nombre" name="nombre" required maxlength="100">
				</div>
				<div>
					<label for="descripcion">Descripción</label>
					<textarea id="descripcion" name="descripcion" maxlength="500" rows="3"></textarea>
				</div>
				<div>
					<label for="precio">Precio *</label>
					<input type="number" id="precio" name="precio" required min="0" step="0.01">
				</div>
				<div>
					<label for="stock">Stock *</label>
					<input type="number" id="stock" name="stock" required min="0" step="1">
				</div>
				<div>
					<label for="stockCritico">Stock Crítico</label>
					<input type="number" id="stockCritico" name="stockCritico" min="0" step="1">
					<small class="editar-small">Se mostrará alerta si el stock es igual o menor a este valor.</small>
				</div>
				<div>
					<label for="categoria">Categoría *</label>
					<select id="categoria" name="categoria" required>
						<option value="">Seleccione una categoría</option>
						<option value="vasos">Vasos</option>
						<option value="copas">Copas</option>
						<option value="placas">Placas</option>
						<option value="otros">Otros</option>
					</select>
				</div>
				<div>
					<label for="imagen">Imagen</label>
					<input type="file" id="imagen" name="imagen" accept="image/*">
					<div id="imagen-actual"></div>
				</div>
				<button type="submit" class="editar-btn">Guardar Cambios</button>
			</form>
			<div class="editar-volver">
				<a href="adm-prodcutos.html">Volver a administración</a>
			</div>
		</main>
	</div>
		<script src="../../js/funcionesProductos.js"></script>
		<script>
			// Obtener parámetro de código por querystring
			function getCodigoProducto() {
				const params = new URLSearchParams(window.location.search);
				return params.get('codigo');
			}
			// Precargar datos del producto
			function precargarProducto(codigoPrecargar = null) {
				const codigo = codigoPrecargar || getCodigoProducto();
				if (!codigo) return;
				const productos = obtenerProductos();
				const prod = productos.find(p => p.codigo === codigo);
				if (!prod) return;
				document.getElementById('codigo').value = prod.codigo;
				document.getElementById('nombre').value = prod.nombre;
				document.getElementById('descripcion').value = prod.descripcion || '';
				document.getElementById('precio').value = prod.precio;
				document.getElementById('stock').value = prod.stock;
				document.getElementById('stockCritico').value = prod.stockCritico !== null && prod.stockCritico !== undefined ? prod.stockCritico : '';
				document.getElementById('categoria').value = prod.categoria;
				if (prod.imagen) {
					document.getElementById('imagen-actual').innerHTML = `<span style='color:#888;'>Imagen actual:</span><br><img src='../../img/Productos/${prod.imagen}' alt='${prod.nombre}' style='width:60px; border-radius:6px;'>`;
				} else {
					document.getElementById('imagen-actual').innerHTML = '';
				}
			}

				// Buscador de productos con autocompletado
				function mostrarSugerencias() {
					const input = document.getElementById('buscador-producto');
					const lista = document.getElementById('sugerencias-producto');
					const filtro = input.value.trim().toLowerCase();
					const productos = obtenerProductos();
					if (!filtro) {
						lista.style.display = 'none';
						lista.innerHTML = '';
						return;
					}
					const sugerencias = productos.filter(p =>
						p.nombre.toLowerCase().includes(filtro) || p.codigo.toLowerCase().includes(filtro)
					);
					if (sugerencias.length === 0) {
						lista.style.display = 'none';
						lista.innerHTML = '';
						return;
					}
					lista.innerHTML = sugerencias.map(prod =>
						`<li data-codigo="${prod.codigo}" style="padding:8px 14px; cursor:pointer; border-bottom:1px solid #eee;">${prod.nombre} <span style='color:#888;'>[${prod.codigo}]</span></li>`
					).join('');
					lista.style.display = 'block';
					// Evento click sugerencia
					lista.querySelectorAll('li').forEach(li => {
						li.addEventListener('click', function() {
							input.value = this.textContent;
							lista.style.display = 'none';
							precargarProducto(this.dataset.codigo);
						});
					});
				}

				document.addEventListener('DOMContentLoaded', function() {
					precargarProducto();
					document.getElementById('buscador-producto').addEventListener('input', mostrarSugerencias);
					// Ocultar sugerencias al hacer click fuera
					document.addEventListener('click', function(e) {
						if (!e.target.closest('#buscador-producto') && !e.target.closest('#sugerencias-producto')) {
							document.getElementById('sugerencias-producto').style.display = 'none';
						}
					});
				});
		</script>
</body>
</html>
